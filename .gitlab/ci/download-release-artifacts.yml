.download:
  stage: download
  image: debian:bookworm-slim


  before_script:
  - |
    if [[ ${CI_COMMIT_TAG:-} ]]; then
        UPSTREAM_VERSION=${CI_COMMIT_TAG#v}
    else
        echo "Invalid upstream version"
        exit 1
    fi
    if [[ $CI_DISPOSABLE_ENVIRONMENT ]]; then
      apt-get update -qy
      apt-get install -qy --no-install-recommends wget ca-certificates pristine-lfs
    fi

  script:
  - |
    echo '### pulling existing orig via lfs-storage'
    git fetch --quiet --depth 1 origin lfs-storage
    git lfs pull --include "metalbond_${UPSTREAM_VERSION}.*"
    mkdir _output
    cp *.deb _output
    cd _output

  artifacts:
    paths:
    - _output/*{TARGET_ARCH}.*

download amd64:
  extends: .download
  variables:
    TARGET_ARCH: amd64

download arm64:
  extends: .download
  variables:
    TARGET_ARCH: arm64

