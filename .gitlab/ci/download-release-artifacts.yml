.download:
  stage: download
  image: debian:bookworm-slim


  before_script:
  - |
    if [[ ${CI_COMMIT_TAG:-} ]]; then
        UPSTREAM_VERSION=${CI_COMMIT_TAG#v}
    else
        echo "Invalid upstream version"
        exit 1
    fi
    if [[ $CI_DISPOSABLE_ENVIRONMENT ]]; then
      apt-get update -qy
      apt-get install -qy --no-install-recommends wget ca-certificates
    fi

  script:
  - |
    mkdir _output
    cd _output
    wget https://github.com/onmetal/metalbond/releases/download/v${UPSTREAM_VERSION}/metalbond_${UPSTREAM_VERSION}_${TARGET_ARCH}.deb

  artifacts:
    paths:
    - _output/*{TARGET_ARCH}.*

download amd64:
  extends: .download
  variables:
    TARGET_ARCH: amd64

download arm64:
  extends: .download
  variables:
    TARGET_ARCH: arm64

